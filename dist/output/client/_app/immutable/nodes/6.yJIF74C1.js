import{a as I,t as R}from"../chunks/disclose-version.CCpMAAFc.js";import"../chunks/legacy.BWim2NN6.js";import{p as Ce,A as Ee,B as Ue,a as Ne,g as e,t as O,s as n,C as ge,c as r,b as a,r as o,D as T,n as ze,m as p,E as te}from"../chunks/runtime.BL0abR6R.js";import{e as P,s as me}from"../chunks/render.CxwJUUM4.js";import{i as ae}from"../chunks/store.DfRPK0Rh.js";import{r as U}from"../chunks/attributes.HwkUCdGZ.js";import{b as N}from"../chunks/input.DEjAtde0.js";import{F as Fe,a as Je,b as re}from"../chunks/FormSearch.BTfTaHCP.js";import{i as Le}from"../chunks/lifecycle.DtcGbrmE.js";import{o as Be}from"../chunks/index-client.C2hQeMyM.js";import{L as Ie}from"../chunks/Layout.BjnZ7Ewd.js";var Re=R('<div class="fixed bottom-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg animate-fade-in svelte-h4va85"> </div>'),qe=R('<div class="fixed inset-0 bg-black/50 flex justify-center items-center z-50"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-96"><h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">æ·»åŠ ç”¨æˆ·</h2> <div class="mt-4"><label class="block text-gray-700 dark:text-gray-300">ç”¨æˆ·å</label> <input type="text" class="w-full p-2 border border-gray-300 rounded mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="è¾“å…¥ç”¨æˆ·å"></div> <div class="mt-4"><label class="block text-gray-700 dark:text-gray-300">å¯†ç </label> <input type="password" class="w-full p-2 border border-gray-300 rounded mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="è¾“å…¥ç”¨æˆ·å"></div> <div class="mt-4"><label class="block text-gray-700 dark:text-gray-300">é‚®ç®±</label> <input type="email" class="w-full p-2 border border-gray-300 rounded mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="è¾“å…¥é‚®ç®±"></div> <div class="mt-4"><label class="block text-gray-700 dark:text-gray-300">è§’è‰²</label> <select class="w-full p-2 border border-gray-300 rounded mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white svelte-h4va85"><option>ç”¨æˆ·</option><option>ç®¡ç†å‘˜</option></select></div> <div class="mt-6 flex justify-end gap-2"><button class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">å–æ¶ˆ</button> <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">æäº¤</button></div></div></div>'),Qe=R('<div class="fixed inset-0 bg-black/50 flex justify-center items-center z-50"><div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-96"><h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯</h2> <div class="mt-4"><label class="block text-gray-700 dark:text-gray-300">ç”¨æˆ·å</label> <input type="text" class="w-full p-2 border border-gray-300 rounded mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div> <div class="mt-4"><label class="block text-gray-700 dark:text-gray-300">é‚®ç®±</label> <input type="email" class="w-full p-2 border border-gray-300 rounded mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></div> <div class="mt-4"><label class="block text-gray-700 dark:text-gray-300">è§’è‰²</label> <select class="w-full p-2 border border-gray-300 rounded mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white svelte-h4va85"><option>ç”¨æˆ·</option><option>ç®¡ç†å‘˜</option></select></div> <div class="mt-6 flex justify-end gap-2"><button class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">å–æ¶ˆ</button> <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">æäº¤</button></div></div></div>'),Ge=R('<div><!> <!> <!> <!> <!> <div class="pagination-container flex justify-between items-center mt-4 svelte-h4va85"><div class="flex items-center"><label for="itemsPerPage" class="mr-2 text-lightText dark:text-darkText">æ¯é¡µæ˜¾ç¤º</label> <select id="itemsPerPage" class="p-2 border border-borderLight dark:border-borderDark rounded svelte-h4va85"><option>5</option><option>10</option><option>20</option><option>50</option></select> <span class="ml-2 text-lightText dark:text-darkText">æ¡</span></div> <div class="pagination-buttons flex items-center"><button class="btn-pagination svelte-h4va85">ä¸Šä¸€é¡µ</button> <span class="mx-4 text-lightText dark:text-darkText"> </span> <button class="btn-pagination svelte-h4va85">ä¸‹ä¸€é¡µ</button></div></div></div>');function ot(he,ye){Ce(ye,!1);let ke=[{label:"ç”¨æˆ·ID",key:"id",sortable:!0},{label:"ç”¨æˆ·å",key:"username",sortable:!0},{label:"é‚®ç®±",key:"email",sortable:!0},{label:"è§’è‰²",key:"role",sortable:!1},{label:"åˆ›å»ºæ—¶é—´",key:"created_at",sortable:!0}],q=p(!1),oe=p(""),j=p([]),Q=p(0),g=p(1),h=p(5),se=1,fe=[{key:"username",label:"ç”¨æˆ·å"},{key:"email",label:"é‚®ç®±"}],le={},G=p(!1),d=p({id:null,username:"",email:"",role:"user"}),z=p(!1),i=p({username:"",email:"",password:"123456",role:"user"});const F=t=>{const s=document.cookie.match(new RegExp(`(^| )${t}=([^;]+)`));return s?decodeURIComponent(s[2]):null},H=t=>{n(oe,t),n(q,!0),setTimeout(()=>n(q,!1),3e3)},J=async()=>{try{const t=F("auth_token");if(!t){console.error("Missing auth token");return}const s={page:Number(e(g)),limit:Number(e(h)),filters:le};console.log("ğŸ“¡ å‘é€è¯·æ±‚å‚æ•°:",s);const l=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify(s)});if(!l.ok)throw new Error(`Failed to fetch data from /api/users: ${l.status}`);const c=await l.json();console.log("âœ… åç«¯è¿”å›æ•°æ®:",c),n(j,c.users.map(u=>({id:u.id,username:u.username,email:u.email,role:u.role,created_at:new Date(u.created_at).toLocaleString()}))),n(Q,c.total??0),se=Math.ceil(e(Q)/e(h))}catch(t){console.error("âŒ Error fetching user data:",t)}},K=t=>{t<1||t>se||(n(g,t),J())},_e=t=>{le=t.detail.filters,n(g,1),J()},xe=async t=>{const{id:s,username:l}=t.detail;try{const c=F("auth_token");if(!c){console.error("Unauthorized: Missing token");return}const u=await fetch("/api/users/delete",{method:"POST",headers:{"Content-Type":"application/json",Authorization:c},body:JSON.stringify({id:s})});if(!u.ok){const S=await u.json();console.error("Failed to delete user:",S);return}H(`ç”¨æˆ·å·²åˆ é™¤: ${l}`),n(j,e(j).filter(S=>S.id!==s))}catch(c){console.error("Error deleting user:",c)}},we=async()=>{n(z,!0),await ge(),console.log("showAddModal:",e(z))},ie=()=>{n(z,!1),n(i,{username:"",email:"",password:"123456",role:"user"})},ne=()=>{n(G,!1)},Te=async()=>{try{const t=F("auth_token");if(!t){console.error("Missing auth token");return}const s=await fetch("/api/users/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify(e(i))});if(!s.ok){const l=await s.json();console.error("Failed to add user:",l);return}H(`æ–°å¢ç”¨æˆ·: ${e(i).username}`),ie(),J()}catch(t){console.error("Error adding user:",t)}},Pe=async t=>{const{ids:s}=t.detail;await fetch("/api/users/bulk-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:s})}),n(j,e(j).filter(l=>!s.includes(l.id)))},je=async()=>{try{const t=F("auth_token");if(!t){console.error("Missing auth token");return}const s=await fetch("/api/users/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify(e(d))}),l=await s.json();s.ok?(H(`æ›´æ–°ç”¨æˆ·æˆåŠŸ: ${e(d).username}`),ne()):alert("æ›´æ–°å¤±è´¥ï¼š"+l.details)}catch(t){console.error("æ›´æ–°ç”¨æˆ·æ—¶å‡ºé”™ï¼š",t)}},Se=async t=>{const{id:s,username:l,email:c,role:u}=t.detail;console.log("æ”¶åˆ°ç¼–è¾‘è¯·æ±‚:",t.detail),n(d,{id:s,username:l,email:c,role:u}),n(G,!0),await ge()};Be(()=>{console.log("itemsPerPage åˆå§‹åŒ–:",e(h))}),Ee(()=>{},()=>{J()}),Ue(),Le(),Ie(he,{children:(t,s)=>{var l=Ge(),c=r(l);Fe(c,{searchParams:fe,$$events:{search:_e}});var u=a(c,2);Je(u,{columns:ke,get rows(){return e(j)},$$events:{delete:xe,bulkDelete:Pe,edit:Se,addUser:we}});var S=a(u,2);{var $e=v=>{var b=Re(),y=r(b,!0);o(b),O(()=>me(y,e(oe))),I(v,b)};ae(S,v=>{e(q)&&v($e)})}var de=a(S,2);{var Me=v=>{var b=qe(),y=r(b),k=a(r(y),2),A=a(r(k),2);U(A),o(k);var f=a(k,2),C=a(r(f),2);U(C),o(f);var _=a(f,2),$=a(r(_),2);U($),o(_);var x=a(_,2),M=a(r(x),2);O(()=>{e(i),te(()=>{})});var D=r(M);D.value=(D.__value="user")==null?"":"user";var E=a(D);E.value=(E.__value="admin")==null?"":"admin",o(M),o(x);var B=a(x,2),m=r(B),Ae=a(m,2);o(B),o(y),o(b),N(A,()=>e(i).username,w=>T(i,e(i).username=w)),N(C,()=>e(i).password,w=>T(i,e(i).password=w)),N($,()=>e(i).email,w=>T(i,e(i).email=w)),re(M,()=>e(i).role,w=>T(i,e(i).role=w)),P("click",m,ie),P("click",Ae,Te),I(v,b)};ae(de,v=>{e(z)&&v(Me)})}var ce=a(de,2);{var De=v=>{var b=Qe(),y=r(b),k=a(r(y),2),A=a(r(k),2);U(A),o(k);var f=a(k,2),C=a(r(f),2);U(C),o(f);var _=a(f,2),$=a(r(_),2);O(()=>{e(d),te(()=>{})});var x=r($);x.value=(x.__value="user")==null?"":"user";var M=a(x);M.value=(M.__value="admin")==null?"":"admin",o($),o(_);var D=a(_,2),E=r(D),B=a(E,2);o(D),o(y),o(b),N(A,()=>e(d).username,m=>T(d,e(d).username=m)),N(C,()=>e(d).email,m=>T(d,e(d).email=m)),re($,()=>e(d).role,m=>T(d,e(d).role=m)),P("click",E,ne),P("click",B,je),I(v,b)};ae(ce,v=>{e(G)&&v(De)})}var ue=a(ce,2),V=r(ue),L=a(r(V),2);O(()=>{e(h),te(()=>{})});var W=r(L);W.value=(W.__value=5)==null?"":5;var X=a(W);X.value=(X.__value=10)==null?"":10;var Y=a(X);Y.value=(Y.__value=20)==null?"":20;var ve=a(Y);ve.value=(ve.__value=50)==null?"":50,o(L),ze(2),o(V);var be=a(V,2),Z=r(be),ee=a(Z,2),Oe=r(ee);o(ee);var pe=a(ee,2);O(()=>pe.disabled=e(g)>=Math.ceil(e(Q)/e(h))),o(be),o(ue),o(l),O(()=>{Z.disabled=e(g)<=1,me(Oe,`ç¬¬ ${e(g)??""} é¡µ`)}),re(L,()=>e(h),v=>n(h,v)),P("change",L,()=>K(1)),P("click",Z,()=>K(e(g)-1)),P("click",pe,()=>K(e(g)+1)),I(t,l)},$$slots:{default:!0}}),Ne()}export{ot as component};
